import { Amplify } from 'aws-amplify';
import { signIn, signOut, getCurrentUser, fetchAuthSession, } from 'aws-amplify/auth';
// Cognito configuration from CDK outputs
const COGNITO_USER_POOL_ID = import.meta.env.VITE_COGNITO_USER_POOL_ID || 'us-east-1_65hpvHpPX';
const COGNITO_USER_POOL_CLIENT_ID = import.meta.env.VITE_COGNITO_USER_POOL_CLIENT_ID || 'jhnvud4iqcf15vac6nc2d2b9p';
// Configure Amplify
Amplify.configure({
    Auth: {
        Cognito: {
            userPoolId: COGNITO_USER_POOL_ID,
            userPoolClientId: COGNITO_USER_POOL_CLIENT_ID,
            loginWith: {
                email: true,
            },
        },
    },
});
const TOKEN_KEY = 'cognito_id_token';
/**
 * Sign in with email and password
 */
export async function login(email, password) {
    try {
        const output = await signIn({
            username: email,
            password,
        });
        // Store token after successful sign-in
        if (output.isSignedIn) {
            await storeToken();
        }
        return output;
    }
    catch (error) {
        console.error('Login error:', error);
        throw error;
    }
}
/**
 * Sign out the current user
 */
export async function logout() {
    try {
        await signOut();
        localStorage.removeItem(TOKEN_KEY);
    }
    catch (error) {
        console.error('Logout error:', error);
        // Clear token even if signOut fails
        localStorage.removeItem(TOKEN_KEY);
        throw error;
    }
}
/**
 * Get the current authentication token
 */
export async function getToken() {
    try {
        // Try to get from session first
        const session = await fetchAuthSession();
        if (session.tokens?.idToken) {
            const token = session.tokens.idToken.toString();
            localStorage.setItem(TOKEN_KEY, token);
            return token;
        }
        // Fallback to localStorage
        return localStorage.getItem(TOKEN_KEY);
    }
    catch (error) {
        console.error('Error getting token:', error);
        // Fallback to localStorage
        return localStorage.getItem(TOKEN_KEY);
    }
}
/**
 * Store token in localStorage
 */
async function storeToken() {
    try {
        const session = await fetchAuthSession();
        if (session.tokens?.idToken) {
            const token = session.tokens.idToken.toString();
            localStorage.setItem(TOKEN_KEY, token);
        }
    }
    catch (error) {
        console.error('Error storing token:', error);
    }
}
/**
 * Check if user is authenticated
 */
export async function isAuthenticated() {
    try {
        const user = await getCurrentUser();
        return !!user;
    }
    catch (error) {
        return false;
    }
}
/**
 * Get current user info
 */
export async function getCurrentUserInfo() {
    try {
        const user = await getCurrentUser();
        return user;
    }
    catch (error) {
        return null;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImF1dGgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUN0QyxPQUFPLEVBQ0wsTUFBTSxFQUNOLE9BQU8sRUFDUCxjQUFjLEVBQ2QsZ0JBQWdCLEdBRWpCLE1BQU0sa0JBQWtCLENBQUM7QUFFMUIseUNBQXlDO0FBQ3pDLE1BQU0sb0JBQW9CLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMseUJBQXlCLElBQUkscUJBQXFCLENBQUM7QUFDaEcsTUFBTSwyQkFBMkIsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxnQ0FBZ0MsSUFBSSwyQkFBMkIsQ0FBQztBQUVwSCxvQkFBb0I7QUFDcEIsT0FBTyxDQUFDLFNBQVMsQ0FBQztJQUNoQixJQUFJLEVBQUU7UUFDSixPQUFPLEVBQUU7WUFDUCxVQUFVLEVBQUUsb0JBQW9CO1lBQ2hDLGdCQUFnQixFQUFFLDJCQUEyQjtZQUM3QyxTQUFTLEVBQUU7Z0JBQ1QsS0FBSyxFQUFFLElBQUk7YUFDWjtTQUNGO0tBQ0Y7Q0FDRixDQUFDLENBQUM7QUFFSCxNQUFNLFNBQVMsR0FBRyxrQkFBa0IsQ0FBQztBQUVyQzs7R0FFRztBQUNILE1BQU0sQ0FBQyxLQUFLLFVBQVUsS0FBSyxDQUFDLEtBQWEsRUFBRSxRQUFnQjtJQUN6RCxJQUFJLENBQUM7UUFDSCxNQUFNLE1BQU0sR0FBRyxNQUFNLE1BQU0sQ0FBQztZQUMxQixRQUFRLEVBQUUsS0FBSztZQUNmLFFBQVE7U0FDVCxDQUFDLENBQUM7UUFFSCx1Q0FBdUM7UUFDdkMsSUFBSSxNQUFNLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDdEIsTUFBTSxVQUFVLEVBQUUsQ0FBQztRQUNyQixDQUFDO1FBRUQsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNyQyxNQUFNLEtBQUssQ0FBQztJQUNkLENBQUM7QUFDSCxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLENBQUMsS0FBSyxVQUFVLE1BQU07SUFDMUIsSUFBSSxDQUFDO1FBQ0gsTUFBTSxPQUFPLEVBQUUsQ0FBQztRQUNoQixZQUFZLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDdEMsb0NBQW9DO1FBQ3BDLFlBQVksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbkMsTUFBTSxLQUFLLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxDQUFDLEtBQUssVUFBVSxRQUFRO0lBQzVCLElBQUksQ0FBQztRQUNILGdDQUFnQztRQUNoQyxNQUFNLE9BQU8sR0FBRyxNQUFNLGdCQUFnQixFQUFFLENBQUM7UUFDekMsSUFBSSxPQUFPLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxDQUFDO1lBQzVCLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ2hELFlBQVksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3ZDLE9BQU8sS0FBSyxDQUFDO1FBQ2YsQ0FBQztRQUVELDJCQUEyQjtRQUMzQixPQUFPLFlBQVksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFzQixFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzdDLDJCQUEyQjtRQUMzQixPQUFPLFlBQVksQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDekMsQ0FBQztBQUNILENBQUM7QUFFRDs7R0FFRztBQUNILEtBQUssVUFBVSxVQUFVO0lBQ3ZCLElBQUksQ0FBQztRQUNILE1BQU0sT0FBTyxHQUFHLE1BQU0sZ0JBQWdCLEVBQUUsQ0FBQztRQUN6QyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLENBQUM7WUFDNUIsTUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDaEQsWUFBWSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDekMsQ0FBQztJQUNILENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUMvQyxDQUFDO0FBQ0gsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxDQUFDLEtBQUssVUFBVSxlQUFlO0lBQ25DLElBQUksQ0FBQztRQUNILE1BQU0sSUFBSSxHQUFHLE1BQU0sY0FBYyxFQUFFLENBQUM7UUFDcEMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0FBQ0gsQ0FBQztBQUVEOztHQUVHO0FBQ0gsTUFBTSxDQUFDLEtBQUssVUFBVSxrQkFBa0I7SUFDdEMsSUFBSSxDQUFDO1FBQ0gsTUFBTSxJQUFJLEdBQUcsTUFBTSxjQUFjLEVBQUUsQ0FBQztRQUNwQyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2YsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFtcGxpZnkgfSBmcm9tICdhd3MtYW1wbGlmeSc7XG5pbXBvcnQge1xuICBzaWduSW4sXG4gIHNpZ25PdXQsXG4gIGdldEN1cnJlbnRVc2VyLFxuICBmZXRjaEF1dGhTZXNzaW9uLFxuICB0eXBlIFNpZ25Jbk91dHB1dCxcbn0gZnJvbSAnYXdzLWFtcGxpZnkvYXV0aCc7XG5cbi8vIENvZ25pdG8gY29uZmlndXJhdGlvbiBmcm9tIENESyBvdXRwdXRzXG5jb25zdCBDT0dOSVRPX1VTRVJfUE9PTF9JRCA9IGltcG9ydC5tZXRhLmVudi5WSVRFX0NPR05JVE9fVVNFUl9QT09MX0lEIHx8ICd1cy1lYXN0LTFfNjVocHZIcFBYJztcbmNvbnN0IENPR05JVE9fVVNFUl9QT09MX0NMSUVOVF9JRCA9IGltcG9ydC5tZXRhLmVudi5WSVRFX0NPR05JVE9fVVNFUl9QT09MX0NMSUVOVF9JRCB8fCAnamhudnVkNGlxY2YxNXZhYzZuYzJkMmI5cCc7XG5cbi8vIENvbmZpZ3VyZSBBbXBsaWZ5XG5BbXBsaWZ5LmNvbmZpZ3VyZSh7XG4gIEF1dGg6IHtcbiAgICBDb2duaXRvOiB7XG4gICAgICB1c2VyUG9vbElkOiBDT0dOSVRPX1VTRVJfUE9PTF9JRCxcbiAgICAgIHVzZXJQb29sQ2xpZW50SWQ6IENPR05JVE9fVVNFUl9QT09MX0NMSUVOVF9JRCxcbiAgICAgIGxvZ2luV2l0aDoge1xuICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSxcbn0pO1xuXG5jb25zdCBUT0tFTl9LRVkgPSAnY29nbml0b19pZF90b2tlbic7XG5cbi8qKlxuICogU2lnbiBpbiB3aXRoIGVtYWlsIGFuZCBwYXNzd29yZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9naW4oZW1haWw6IHN0cmluZywgcGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8U2lnbkluT3V0cHV0PiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgb3V0cHV0ID0gYXdhaXQgc2lnbkluKHtcbiAgICAgIHVzZXJuYW1lOiBlbWFpbCxcbiAgICAgIHBhc3N3b3JkLFxuICAgIH0pO1xuXG4gICAgLy8gU3RvcmUgdG9rZW4gYWZ0ZXIgc3VjY2Vzc2Z1bCBzaWduLWluXG4gICAgaWYgKG91dHB1dC5pc1NpZ25lZEluKSB7XG4gICAgICBhd2FpdCBzdG9yZVRva2VuKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG91dHB1dDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdMb2dpbiBlcnJvcjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLyoqXG4gKiBTaWduIG91dCB0aGUgY3VycmVudCB1c2VyXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dvdXQoKTogUHJvbWlzZTx2b2lkPiB7XG4gIHRyeSB7XG4gICAgYXdhaXQgc2lnbk91dCgpO1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFRPS0VOX0tFWSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignTG9nb3V0IGVycm9yOicsIGVycm9yKTtcbiAgICAvLyBDbGVhciB0b2tlbiBldmVuIGlmIHNpZ25PdXQgZmFpbHNcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShUT0tFTl9LRVkpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogR2V0IHRoZSBjdXJyZW50IGF1dGhlbnRpY2F0aW9uIHRva2VuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRUb2tlbigpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgdHJ5IHtcbiAgICAvLyBUcnkgdG8gZ2V0IGZyb20gc2Vzc2lvbiBmaXJzdFxuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBmZXRjaEF1dGhTZXNzaW9uKCk7XG4gICAgaWYgKHNlc3Npb24udG9rZW5zPy5pZFRva2VuKSB7XG4gICAgICBjb25zdCB0b2tlbiA9IHNlc3Npb24udG9rZW5zLmlkVG9rZW4udG9TdHJpbmcoKTtcbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFRPS0VOX0tFWSwgdG9rZW4pO1xuICAgICAgcmV0dXJuIHRva2VuO1xuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrIHRvIGxvY2FsU3RvcmFnZVxuICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShUT0tFTl9LRVkpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgdG9rZW46JywgZXJyb3IpO1xuICAgIC8vIEZhbGxiYWNrIHRvIGxvY2FsU3RvcmFnZVxuICAgIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShUT0tFTl9LRVkpO1xuICB9XG59XG5cbi8qKlxuICogU3RvcmUgdG9rZW4gaW4gbG9jYWxTdG9yYWdlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHN0b3JlVG9rZW4oKTogUHJvbWlzZTx2b2lkPiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGZldGNoQXV0aFNlc3Npb24oKTtcbiAgICBpZiAoc2Vzc2lvbi50b2tlbnM/LmlkVG9rZW4pIHtcbiAgICAgIGNvbnN0IHRva2VuID0gc2Vzc2lvbi50b2tlbnMuaWRUb2tlbi50b1N0cmluZygpO1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oVE9LRU5fS0VZLCB0b2tlbik7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHN0b3JpbmcgdG9rZW46JywgZXJyb3IpO1xuICB9XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdXNlciBpcyBhdXRoZW50aWNhdGVkXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpc0F1dGhlbnRpY2F0ZWQoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGdldEN1cnJlbnRVc2VyKCk7XG4gICAgcmV0dXJuICEhdXNlcjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgY3VycmVudCB1c2VyIGluZm9cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VySW5mbygpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB1c2VyID0gYXdhaXQgZ2V0Q3VycmVudFVzZXIoKTtcbiAgICByZXR1cm4gdXNlcjtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4iXX0=