import { describe, it, expect, vi, beforeEach } from 'vitest';
import { uploadEssay, getEssay, checkHealth } from './api';
// Mock fetch
const mockFetch = vi.fn();
globalThis.fetch = mockFetch;
describe('API Client', () => {
    beforeEach(() => {
        vi.clearAllMocks();
    });
    describe('uploadEssay', () => {
        it('should upload essay successfully', async () => {
            const mockResponse = {
                essay_id: 'test-id-123',
                status: 'awaiting_processing',
                file_key: 'essays/test-id-123.txt',
            };
            mockFetch.mockResolvedValueOnce({
                ok: true,
                json: async () => mockResponse,
            });
            const result = await uploadEssay('Test essay text');
            expect(mockFetch).toHaveBeenCalledWith(expect.stringContaining('/essay'), expect.objectContaining({
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ essay_text: 'Test essay text' }),
            }));
            expect(result).toEqual(mockResponse);
        });
        it('should throw error on failed upload', async () => {
            mockFetch.mockResolvedValueOnce({
                ok: false,
                statusText: 'Bad Request',
            });
            await expect(uploadEssay('Test')).rejects.toThrow('Failed to upload essay');
        });
    });
    describe('getEssay', () => {
        it('should fetch essay successfully', async () => {
            const mockResponse = {
                essay_id: 'test-id-123',
                status: 'processed',
                metrics: {
                    word_count: 100,
                    unique_words: 80,
                    type_token_ratio: 0.8,
                },
                feedback: [],
            };
            mockFetch.mockResolvedValueOnce({
                ok: true,
                json: async () => mockResponse,
            });
            const result = await getEssay('test-id-123');
            expect(mockFetch).toHaveBeenCalledWith(expect.stringContaining('/essay/test-id-123'));
            expect(result).toEqual(mockResponse);
        });
        it('should throw error for 404', async () => {
            mockFetch.mockResolvedValueOnce({
                ok: false,
                status: 404,
            });
            await expect(getEssay('non-existent')).rejects.toThrow('Essay not found');
        });
        it('should throw error on other failures', async () => {
            mockFetch.mockResolvedValueOnce({
                ok: false,
                status: 500,
                statusText: 'Internal Server Error',
            });
            await expect(getEssay('test-id')).rejects.toThrow('Failed to fetch essay');
        });
    });
    describe('checkHealth', () => {
        it('should check health successfully', async () => {
            mockFetch.mockResolvedValueOnce({
                ok: true,
                json: async () => ({ status: 'ok' }),
            });
            const result = await checkHealth();
            expect(mockFetch).toHaveBeenCalledWith(expect.stringContaining('/health'));
            expect(result).toEqual({ status: 'ok' });
        });
        it('should throw error on health check failure', async () => {
            mockFetch.mockResolvedValueOnce({
                ok: false,
            });
            await expect(checkHealth()).rejects.toThrow('Health check failed');
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBpLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhcGkudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLFVBQVUsRUFBRSxNQUFNLFFBQVEsQ0FBQTtBQUM3RCxPQUFPLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQXNCLE1BQU0sT0FBTyxDQUFBO0FBRTlFLGFBQWE7QUFDYixNQUFNLFNBQVMsR0FBRyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUE7QUFDekIsVUFBVSxDQUFDLEtBQUssR0FBRyxTQUFnQixDQUFBO0FBRW5DLFFBQVEsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO0lBQzFCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUE7SUFDcEIsQ0FBQyxDQUFDLENBQUE7SUFFRixRQUFRLENBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUMzQixFQUFFLENBQUMsa0NBQWtDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDaEQsTUFBTSxZQUFZLEdBQWtCO2dCQUNsQyxRQUFRLEVBQUUsYUFBYTtnQkFDdkIsTUFBTSxFQUFFLHFCQUFxQjtnQkFDN0IsUUFBUSxFQUFFLHdCQUF3QjthQUNuQyxDQUFBO1lBRUQsU0FBUyxDQUFDLHFCQUFxQixDQUFDO2dCQUM5QixFQUFFLEVBQUUsSUFBSTtnQkFDUixJQUFJLEVBQUUsS0FBSyxJQUFJLEVBQUUsQ0FBQyxZQUFZO2FBQy9CLENBQUMsQ0FBQTtZQUVGLE1BQU0sTUFBTSxHQUFHLE1BQU0sV0FBVyxDQUFDLGlCQUFpQixDQUFDLENBQUE7WUFFbkQsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLG9CQUFvQixDQUNwQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLEVBQ2pDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQztnQkFDdEIsTUFB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TUFBTSxNQUFNLEdBQUcsTUFBTSxXQUFXLEVBQUUsQ0FBQTtZQUVsQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsb0JBQW9CLENBQ3BDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FDbkMsQ0FBQTtZQUNELE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQTtRQUMxQyxDQUFDLENBQUMsQ0FBQTtRQUVGLEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMxRCxTQUFTLENBQUMscUJBQXFCLENBQUM7Z0JBQzlCLEVBQUUsRUFBRSxLQUFLO2FBQ1YsQ0FBQyxDQUFBO1lBRUYsTUFBTSxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUE7UUFDcEUsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIHZpLCBiZWZvcmVFYWNoIH0gZnJvbSAndml0ZXN0J1xuaW1wb3J0IHsgdXBsb2FkRXNzYXksIGdldEVzc2F5LCBjaGVja0hlYWx0aCwgdHlwZSBFc3NheVJlc3BvbnNlIH0gZnJvbSAnLi9hcGknXG5cbi8vIE1vY2sgZmV0Y2hcbmNvbnN0IG1vY2tGZXRjaCA9IHZpLmZuKClcbmdsb2JhbFRoaXMuZmV0Y2ggPSBtb2NrRmV0Y2ggYXMgYW55XG5cbmRlc2NyaWJlKCdBUEkgQ2xpZW50JywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB2aS5jbGVhckFsbE1vY2tzKClcbiAgfSlcblxuICBkZXNjcmliZSgndXBsb2FkRXNzYXknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB1cGxvYWQgZXNzYXkgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc3BvbnNlOiBFc3NheVJlc3BvbnNlID0ge1xuICAgICAgICBlc3NheV9pZDogJ3Rlc3QtaWQtMTIzJyxcbiAgICAgICAgc3RhdHVzOiAnYXdhaXRpbmdfcHJvY2Vzc2luZycsXG4gICAgICAgIGZpbGVfa2V5OiAnZXNzYXlzL3Rlc3QtaWQtMTIzLnR4dCcsXG4gICAgICB9XG5cbiAgICAgIG1vY2tGZXRjaC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAganNvbjogYXN5bmMgKCkgPT4gbW9ja1Jlc3BvbnNlLFxuICAgICAgfSlcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXBsb2FkRXNzYXkoJ1Rlc3QgZXNzYXkgdGV4dCcpXG5cbiAgICAgIGV4cGVjdChtb2NrRmV0Y2gpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnL2Vzc2F5JyksXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGVzc2F5X3RleHQ6ICdUZXN0IGVzc2F5IHRleHQnIH0pLFxuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrUmVzcG9uc2UpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igb24gZmFpbGVkIHVwbG9hZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tGZXRjaC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICBvazogZmFsc2UsXG4gICAgICAgIHN0YXR1c1RleHQ6ICdCYWQgUmVxdWVzdCcsXG4gICAgICB9KVxuXG4gICAgICBhd2FpdCBleHBlY3QodXBsb2FkRXNzYXkoJ1Rlc3QnKSkucmVqZWN0cy50b1Rocm93KCdGYWlsZWQgdG8gdXBsb2FkIGVzc2F5JylcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCdnZXRFc3NheScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGZldGNoIGVzc2F5IHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXNwb25zZTogRXNzYXlSZXNwb25zZSA9IHtcbiAgICAgICAgZXNzYXlfaWQ6ICd0ZXN0LWlkLTEyMycsXG4gICAgICAgIHN0YXR1czogJ3Byb2Nlc3NlZCcsXG4gICAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgICB3b3JkX2NvdW50OiAxMDAsXG4gICAgICAgICAgdW5pcXVlX3dvcmRzOiA4MCxcbiAgICAgICAgICB0eXBlX3Rva2VuX3JhdGlvOiAwLjgsXG4gICAgICAgIH0sXG4gICAgICAgIGZlZWRiYWNrOiBbXSxcbiAgICAgIH1cblxuICAgICAgbW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgIG9rOiB0cnVlLFxuICAgICAgICBqc29uOiBhc3luYyAoKSA9PiBtb2NrUmVzcG9uc2UsXG4gICAgICB9KVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRFc3NheSgndGVzdC1pZC0xMjMnKVxuXG4gICAgICBleHBlY3QobW9ja0ZldGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJy9lc3NheS90ZXN0LWlkLTEyMycpXG4gICAgICApXG4gICAgICBleHBlY3QocmVzdWx0KS50b0VxdWFsKG1vY2tSZXNwb25zZSlcbiAgICB9KVxuXG4gICAgaXQoJ3Nob3VsZCB0aHJvdyBlcnJvciBmb3IgNDA0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgIG9rOiBmYWxzZSxcbiAgICAgICAgc3RhdHVzOiA0MDQsXG4gICAgICB9KVxuXG4gICAgICBhd2FpdCBleHBlY3QoZ2V0RXNzYXkoJ25vbi1leGlzdGVudCcpKS5yZWplY3RzLnRvVGhyb3coJ0Vzc2F5IG5vdCBmb3VuZCcpXG4gICAgfSlcblxuICAgIGl0KCdzaG91bGQgdGhyb3cgZXJyb3Igb24gb3RoZXIgZmFpbHVyZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRmV0Y2gubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgb2s6IGZhbHNlLFxuICAgICAgICBzdGF0dXM6IDUwMCxcbiAgICAgICAgc3RhdHVzVGV4dDogJ0ludGVybmFsIFNlcnZlciBFcnJvcicsXG4gICAgICB9KVxuXG4gICAgICBhd2FpdCBleHBlY3QoZ2V0RXNzYXkoJ3Rlc3QtaWQnKSkucmVqZWN0cy50b1Rocm93KCdGYWlsZWQgdG8gZmV0Y2ggZXNzYXknKVxuICAgIH0pXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ2NoZWNrSGVhbHRoJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2hlY2sgaGVhbHRoIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tGZXRjaC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAganNvbjogYXN5bmMgKCkgPT4gKHsgc3RhdHVzOiAnb2snIH0pLFxuICAgICAgfSlcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2hlY2tIZWFsdGgoKVxuXG4gICAgICBleHBlY3QobW9ja0ZldGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJy9oZWFsdGgnKVxuICAgICAgKVxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbCh7IHN0YXR1czogJ29rJyB9KVxuICAgIH0pXG5cbiAgICBpdCgnc2hvdWxkIHRocm93IGVycm9yIG9uIGhlYWx0aCBjaGVjayBmYWlsdXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlT25jZSh7XG4gICAgICAgIG9rOiBmYWxzZSxcbiAgICAgIH0pXG5cbiAgICAgIGF3YWl0IGV4cGVjdChjaGVja0hlYWx0aCgpKS5yZWplY3RzLnRvVGhyb3coJ0hlYWx0aCBjaGVjayBmYWlsZWQnKVxuICAgIH0pXG4gIH0pXG59KVxuXG4iXX0=