import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import App from './App';
import * as api from './lib/api';
// Mock the API module
vi.mock('./lib/api');
describe('App Component', () => {
    beforeEach(() => {
        vi.clearAllMocks();
    });
    it('should render the upload form initially', () => {
        render(<App />);
        expect(screen.getByText('Vocabulary Essay Analyzer')).toBeInTheDocument();
        expect(screen.getByPlaceholderText('Paste your essay here...')).toBeInTheDocument();
        expect(screen.getByRole('button', { name: /analyze essay/i })).toBeInTheDocument();
    });
    it('should disable submit button when textarea is empty', () => {
        render(<App />);
        const submitButton = screen.getByRole('button', { name: /analyze essay/i });
        expect(submitButton).toBeDisabled();
    });
    it('should enable submit button when text has content', async () => {
        const user = userEvent.setup();
        render(<App />);
        const textarea = screen.getByPlaceholderText('Paste your essay here...');
        const submitButton = screen.getByRole('button', { name: /analyze essay/i });
        await user.type(textarea, 'Test essay content');
        expect(submitButton).not.toBeDisabled();
    });
    it('should show error when submitting empty text', async () => {
        const user = userEvent.setup();
        render(<App />);
        const textarea = screen.getByPlaceholderText('Paste your essay here...');
        const submitButton = screen.getByRole('button', { name: /analyze essay/i });
        // Type some text first to enable button, then clear it
        await user.type(textarea, 'test');
        await user.clear(textarea);
        // Now button should be disabled, but let's test the validation by directly calling handleSubmit
        // Actually, let's just verify the button is disabled when textarea is empty
        expect(submitButton).toBeDisabled();
        // Type only whitespace - button should still be disabled
        await user.type(textarea, '   ');
        expect(submitButton).toBeDisabled();
    });
    it('should upload essay and show processing status', async () => {
        const user = userEvent.setup();
        const mockUpload = vi.spyOn(api, 'uploadEssay').mockResolvedValue({
            essay_id: 'test-123',
            status: 'awaiting_processing',
            file_key: 'essays/test-123.txt',
        });
        vi.spyOn(api, 'getEssay')
            .mockResolvedValueOnce({
            essay_id: 'test-123',
            status: 'processing',
        })
            .mockResolvedValueOnce({
            essay_id: 'test-123',
            status: 'processed',
            metrics: {
                word_count: 100,
                unique_words: 80,
                type_token_ratio: 0.8,
            },
            feedback: [],
        });
        render(<App />);
        const textarea = screen.getByPlaceholderText('Paste your essay here...');
        const submitButton = screen.getByRole('button', { name: /analyze essay/i });
        await user.type(textarea, 'This is a test essay with some content.');
        await user.click(submitButton);
        expect(mockUpload).toHaveBeenCalledWith('This is a test essay with some content.');
        // Wait for initial status (awaiting_processing shows as "Queued for Processing")
        await waitFor(() => {
            expect(screen.getByText('Queued for Processing')).toBeInTheDocument();
        }, { timeout: 3000 });
    });
    it('should display metrics when essay is processed', async () => {
        const user = userEvent.setup();
        vi.spyOn(api, 'uploadEssay').mockResolvedValue({
            essay_id: 'test-123',
            status: 'processed', // Start with processed to skip polling
            metrics: {
                word_count: 100,
                unique_words: 80,
                type_token_ratio: 0.85,
                noun_ratio: 0.3,
                verb_ratio: 0.25,
                adj_ratio: 0.2,
                adv_ratio: 0.1,
                avg_word_freq_rank: 1500,
            },
            feedback: [],
        });
        render(<App />);
        const textarea = screen.getByPlaceholderText('Paste your essay here...');
        const submitButton = screen.getByRole('button', { name: /analyze essay/i });
        await user.type(textarea, 'Test essay');
        await user.click(submitButton);
        await waitFor(() => {
            expect(screen.getByText('Metrics')).toBeInTheDocument();
        });
        // Check for metrics values
        expect(screen.getByText('100')).toBeInTheDocument(); // word_count
        expect(screen.getByText('80')).toBeInTheDocument(); // unique_words
        expect(screen.getByText('0.85')).toBeInTheDocument(); // type_token_ratio
    });
    it('should display feedback when available', async () => {
        const user = userEvent.setup();
        vi.spyOn(api, 'uploadEssay').mockResolvedValue({
            essay_id: 'test-123',
            status: 'processed', // Start with processed to skip polling
            metrics: {
                word_count: 50,
                unique_words: 40,
                type_token_ratio: 0.8,
            },
            feedback: [
                {
                    word: 'articulated',
                    correct: true,
                    comment: 'Used correctly and appropriately',
                },
                {
                    word: 'incorrectly',
                    correct: false,
                    comment: 'Used incorrectly in this context',
                },
            ],
        });
        render(<App />);
        const textarea = screen.getByPlaceholderText('Paste your essay here...');
        const submitButton = screen.getByRole('button', { name: /analyze essay/i });
        await user.type(textarea, 'Test essay');
        await user.click(submitButton);
        await waitFor(() => {
            expect(screen.getByText('Word-Level Feedback')).toBeInTheDocument();
        });
        // Check for feedback content
        expect(screen.getByText('articulated')).toBeInTheDocument();
        expect(screen.getByText('incorrectly')).toBeInTheDocument();
        expect(screen.getByText(/used correctly/i)).toBeInTheDocument();
    });
    it('should show error message on upload failure', async () => {
        const user = userEvent.setup();
        vi.spyOn(api, 'uploadEssay').mockRejectedValue(new Error('Network error'));
        render(<App />);
        const textarea = screen.getByPlaceholderText('Paste your essay here...');
        const submitButton = screen.getByRole('button', { name: /analyze essay/i });
        await user.type(textarea, 'Test essay');
        await user.click(submitButton);
        await waitFor(() => {
            expect(screen.getByText(/network error/i)).toBeInTheDocument();
        });
    });
    it('should reset form when clicking "Analyze Another Essay"', async () => {
        const user = userEvent.setup();
        vi.spyOn(api, 'uploadEssay').mockResolvedValue({
            essay_id: 'test-123',
            status: 'processed', // Start with processed to skip polling
            metrics: {
                word_count: 50,
                unique_words: 40,
                type_token_ratio: 0.8,
            },
            feedback: [],
        });
        render(<App />);
        const textarea = screen.getByPlaceholderText('Paste your essay here...');
        const submitButton = screen.getByRole('button', { name: /analyze essay/i });
        await user.type(textarea, 'Test essay');
        await user.click(submitButton);
        await waitFor(() => {
            expect(screen.getByText('Metrics')).toBeInTheDocument();
        });
        const resetButton = screen.getByRole('button', { name: /analyze another essay/i });
        await user.click(resetButton);
        // Should show form again
        expect(screen.getByPlaceholderText('Paste your essay here...')).toBeInTheDocument();
        expect(screen.queryByText('Metrics')).not.toBeInTheDocument();
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXBwLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJBcHAudGVzdC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsTUFBTSxRQUFRLENBQUE7QUFDN0QsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE1BQU0sd0JBQXdCLENBQUE7QUFDaEUsT0FBTyxTQUFTLE1BQU0sNkJBQTZCLENBQUE7QUFDbkQsT0FBTyxHQUFHLE1BQU0sT0FBTyxDQUFBO0FBQ3ZCLE9BQU8sS0FBSyxHQUFHLE1BQU0sV0FBVyxDQUFBO0FBRWhDLHNCQUFzQjtBQUN0QixFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBO0FBRXBCLFFBQVEsQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxFQUFFLENBQUMsYUFBYSxFQUFFLENBQUE7SUFDcEIsQ0FBQyxDQUFDLENBQUE7SUFFRixFQUFFLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1FBQ2pELE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxBQUFELEVBQUcsQ0FBQyxDQUFBO1FBRWYsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUE7UUFDekUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQTtRQUNuRixNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxJQUFJLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQTtJQUNwRixDQUFDLENBQUMsQ0FBQTtJQUVGLEVBQUUsQ0FBQyxxREFBcUQsRUFB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LFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLGlCQUFpQixFQUFFLENBQUE7SUFDL0QsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCB2aSwgYmVmb3JlRWFjaCB9IGZyb20gJ3ZpdGVzdCdcbmltcG9ydCB7IHJlbmRlciwgc2NyZWVuLCB3YWl0Rm9yIH0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9yZWFjdCdcbmltcG9ydCB1c2VyRXZlbnQgZnJvbSAnQHRlc3RpbmctbGlicmFyeS91c2VyLWV2ZW50J1xuaW1wb3J0IEFwcCBmcm9tICcuL0FwcCdcbmltcG9ydCAqIGFzIGFwaSBmcm9tICcuL2xpYi9hcGknXG5cbi8vIE1vY2sgdGhlIEFQSSBtb2R1bGVcbnZpLm1vY2soJy4vbGliL2FwaScpXG5cbmRlc2NyaWJlKCdBcHAgQ29tcG9uZW50JywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICB2aS5jbGVhckFsbE1vY2tzKClcbiAgfSlcblxuICBpdCgnc2hvdWxkIHJlbmRlciB0aGUgdXBsb2FkIGZvcm0gaW5pdGlhbGx5JywgKCkgPT4ge1xuICAgIHJlbmRlcig8QXBwIC8+KVxuICAgIFxuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KCdWb2NhYnVsYXJ5IEVzc2F5IEFuYWx5emVyJykpLnRvQmVJblRoZURvY3VtZW50KClcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5UGxhY2Vob2xkZXJUZXh0KCdQYXN0ZSB5b3VyIGVzc2F5IGhlcmUuLi4nKSkudG9CZUluVGhlRG9jdW1lbnQoKVxuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlSb2xlKCdidXR0b24nLCB7IG5hbWU6IC9hbmFseXplIGVzc2F5L2kgfSkpLnRvQmVJblRoZURvY3VtZW50KClcbiAgfSlcblxuICBpdCgnc2hvdWxkIGRpc2FibGUgc3VibWl0IGJ1dHRvbiB3aGVuIHRleHRhcmVhIGlzIGVtcHR5JywgKCkgPT4ge1xuICAgIHJlbmRlcig8QXBwIC8+KVxuICAgIFxuICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL2FuYWx5emUgZXNzYXkvaSB9KVxuICAgIGV4cGVjdChzdWJtaXRCdXR0b24pLnRvQmVEaXNhYmxlZCgpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBlbmFibGUgc3VibWl0IGJ1dHRvbiB3aGVuIHRleHQgaGFzIGNvbnRlbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpXG4gICAgcmVuZGVyKDxBcHAgLz4pXG4gICAgXG4gICAgY29uc3QgdGV4dGFyZWEgPSBzY3JlZW4uZ2V0QnlQbGFjZWhvbGRlclRleHQoJ1Bhc3RlIHlvdXIgZXNzYXkgaGVyZS4uLicpXG4gICAgY29uc3Qgc3VibWl0QnV0dG9uID0gc2NyZWVuLmdldEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAvYW5hbHl6ZSBlc3NheS9pIH0pXG4gICAgXG4gICAgYXdhaXQgdXNlci50eXBlKHRleHRhcmVhLCAnVGVzdCBlc3NheSBjb250ZW50JylcbiAgICBcbiAgICBleHBlY3Qoc3VibWl0QnV0dG9uKS5ub3QudG9CZURpc2FibGVkKClcbiAgfSlcblxuICBpdCgnc2hvdWxkIHNob3cgZXJyb3Igd2hlbiBzdWJtaXR0aW5nIGVtcHR5IHRleHQnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpXG4gICAgcmVuZGVyKDxBcHAgLz4pXG4gICAgXG4gICAgY29uc3QgdGV4dGFyZWEgPSBzY3JlZW4uZ2V0QnlQbGFjZWhvbGRlclRleHQoJ1Bhc3RlIHlvdXIgZXNzYXkgaGVyZS4uLicpXG4gICAgY29uc3Qgc3VibWl0QnV0dG9uID0gc2NyZWVuLmdldEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAvYW5hbHl6ZSBlc3NheS9pIH0pXG4gICAgXG4gICAgLy8gVHlwZSBzb21lIHRleHQgZmlyc3QgdG8gZW5hYmxlIGJ1dHRvbiwgdGhlbiBjbGVhciBpdFxuICAgIGF3YWl0IHVzZXIudHlwZSh0ZXh0YXJlYSwgJ3Rlc3QnKVxuICAgIGF3YWl0IHVzZXIuY2xlYXIodGV4dGFyZWEpXG4gICAgXG4gICAgLy8gTm93IGJ1dHRvbiBzaG91bGQgYmUgZGlzYWJsZWQsIGJ1dCBsZXQncyB0ZXN0IHRoZSB2YWxpZGF0aW9uIGJ5IGRpcmVjdGx5IGNhbGxpbmcgaGFuZGxlU3VibWl0XG4gICAgLy8gQWN0dWFsbHksIGxldCdzIGp1c3QgdmVyaWZ5IHRoZSBidXR0b24gaXMgZGlzYWJsZWQgd2hlbiB0ZXh0YXJlYSBpcyBlbXB0eVxuICAgIGV4cGVjdChzdWJtaXRCdXR0b24pLnRvQmVEaXNhYmxlZCgpXG4gICAgXG4gICAgLy8gVHlwZSBvbmx5IHdoaXRlc3BhY2UgLSBidXR0b24gc2hvdWxkIHN0aWxsIGJlIGRpc2FibGVkXG4gICAgYXdhaXQgdXNlci50eXBlKHRleHRhcmVhLCAnICAgJylcbiAgICBleHBlY3Qoc3VibWl0QnV0dG9uKS50b0JlRGlzYWJsZWQoKVxuICB9KVxuXG4gIGl0KCdzaG91bGQgdXBsb2FkIGVzc2F5IGFuZCBzaG93IHByb2Nlc3Npbmcgc3RhdHVzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHVzZXIgPSB1c2VyRXZlbnQuc2V0dXAoKVxuICAgIGNvbnN0IG1vY2tVcGxvYWQgPSB2aS5zcHlPbihhcGksICd1cGxvYWRFc3NheScpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIGVzc2F5X2lkOiAndGVzdC0xMjMnLFxuICAgICAgc3RhdHVzOiAnYXdhaXRpbmdfcHJvY2Vzc2luZycsXG4gICAgICBmaWxlX2tleTogJ2Vzc2F5cy90ZXN0LTEyMy50eHQnLFxuICAgIH0pXG5cbiAgICB2aS5zcHlPbihhcGksICdnZXRFc3NheScpXG4gICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKHtcbiAgICAgICAgZXNzYXlfaWQ6ICd0ZXN0LTEyMycsXG4gICAgICAgIHN0YXR1czogJ3Byb2Nlc3NpbmcnLFxuICAgICAgfSlcbiAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2Uoe1xuICAgICAgICBlc3NheV9pZDogJ3Rlc3QtMTIzJyxcbiAgICAgICAgc3RhdHVzOiAncHJvY2Vzc2VkJyxcbiAgICAgICAgbWV0cmljczoge1xuICAgICAgICAgIHdvcmRfY291bnQ6IDEwMCxcbiAgICAgICAgICB1bmlxdWVfd29yZHM6IDgwLFxuICAgICAgICAgIHR5cGVfdG9rZW5fcmF0aW86IDAuOCxcbiAgICAgICAgfSxcbiAgICAgICAgZmVlZGJhY2s6IFtdLFxuICAgICAgfSlcblxuICAgIHJlbmRlcig8QXBwIC8+KVxuICAgIFxuICAgIGNvbnN0IHRleHRhcmVhID0gc2NyZWVuLmdldEJ5UGxhY2Vob2xkZXJUZXh0KCdQYXN0ZSB5b3VyIGVzc2F5IGhlcmUuLi4nKVxuICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL2FuYWx5emUgZXNzYXkvaSB9KVxuICAgIFxuICAgIGF3YWl0IHVzZXIudHlwZSh0ZXh0YXJlYSwgJ1RoaXMgaXMgYSB0ZXN0IGVzc2F5IHdpdGggc29tZSBjb250ZW50LicpXG4gICAgYXdhaXQgdXNlci5jbGljayhzdWJtaXRCdXR0b24pXG4gICAgXG4gICAgZXhwZWN0KG1vY2tVcGxvYWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdUaGlzIGlzIGEgdGVzdCBlc3NheSB3aXRoIHNvbWUgY29udGVudC4nKVxuICAgIFxuICAgIC8vIFdhaXQgZm9yIGluaXRpYWwgc3RhdHVzIChhd2FpdGluZ19wcm9jZXNzaW5nIHNob3dzIGFzIFwiUXVldWVkIGZvciBQcm9jZXNzaW5nXCIpXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnUXVldWVkIGZvciBQcm9jZXNzaW5nJykpLnRvQmVJblRoZURvY3VtZW50KClcbiAgICB9LCB7IHRpbWVvdXQ6IDMwMDAgfSlcbiAgfSlcblxuICBpdCgnc2hvdWxkIGRpc3BsYXkgbWV0cmljcyB3aGVuIGVzc2F5IGlzIHByb2Nlc3NlZCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB1c2VyID0gdXNlckV2ZW50LnNldHVwKClcbiAgICB2aS5zcHlPbihhcGksICd1cGxvYWRFc3NheScpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIGVzc2F5X2lkOiAndGVzdC0xMjMnLFxuICAgICAgc3RhdHVzOiAncHJvY2Vzc2VkJywgLy8gU3RhcnQgd2l0aCBwcm9jZXNzZWQgdG8gc2tpcCBwb2xsaW5nXG4gICAgICBtZXRyaWNzOiB7XG4gICAgICAgIHdvcmRfY291bnQ6IDEwMCxcbiAgICAgICAgdW5pcXVlX3dvcmRzOiA4MCxcbiAgICAgICAgdHlwZV90b2tlbl9yYXRpbzogMC44NSxcbiAgICAgICAgbm91bl9yYXRpbzogMC4zLFxuICAgICAgICB2ZXJiX3JhdGlvOiAwLjI1LFxuICAgICAgICBhZGpfcmF0aW86IDAuMixcbiAgICAgICAgYWR2X3JhdGlvOiAwLjEsXG4gICAgICAgIGF2Z193b3JkX2ZyZXFfcmFuazogMTUwMCxcbiAgICAgIH0sXG4gICAgICBmZWVkYmFjazogW10sXG4gICAgfSlcblxuICAgIHJlbmRlcig8QXBwIC8+KVxuICAgIFxuICAgIGNvbnN0IHRleHRhcmVhID0gc2NyZWVuLmdldEJ5UGxhY2Vob2xkZXJUZXh0KCdQYXN0ZSB5b3VyIGVzc2F5IGhlcmUuLi4nKVxuICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL2FuYWx5emUgZXNzYXkvaSB9KVxuICAgIFxuICAgIGF3YWl0IHVzZXIudHlwZSh0ZXh0YXJlYSwgJ1Rlc3QgZXNzYXknKVxuICAgIGF3YWl0IHVzZXIuY2xpY2soc3VibWl0QnV0dG9uKVxuICAgIFxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoJ01ldHJpY3MnKSkudG9CZUluVGhlRG9jdW1lbnQoKVxuICAgIH0pXG4gICAgXG4gICAgLy8gQ2hlY2sgZm9yIG1ldHJpY3MgdmFsdWVzXG4gICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoJzEwMCcpKS50b0JlSW5UaGVEb2N1bWVudCgpIC8vIHdvcmRfY291bnRcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnODAnKSkudG9CZUluVGhlRG9jdW1lbnQoKSAvLyB1bmlxdWVfd29yZHNcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnMC44NScpKS50b0JlSW5UaGVEb2N1bWVudCgpIC8vIHR5cGVfdG9rZW5fcmF0aW9cbiAgfSlcblxuICBpdCgnc2hvdWxkIGRpc3BsYXkgZmVlZGJhY2sgd2hlbiBhdmFpbGFibGUnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpXG4gICAgdmkuc3B5T24oYXBpLCAndXBsb2FkRXNzYXknKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBlc3NheV9pZDogJ3Rlc3QtMTIzJyxcbiAgICAgIHN0YXR1czogJ3Byb2Nlc3NlZCcsIC8vIFN0YXJ0IHdpdGggcHJvY2Vzc2VkIHRvIHNraXAgcG9sbGluZ1xuICAgICAgbWV0cmljczoge1xuICAgICAgICB3b3JkX2NvdW50OiA1MCxcbiAgICAgICAgdW5pcXVlX3dvcmRzOiA0MCxcbiAgICAgICAgdHlwZV90b2tlbl9yYXRpbzogMC44LFxuICAgICAgfSxcbiAgICAgIGZlZWRiYWNrOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB3b3JkOiAnYXJ0aWN1bGF0ZWQnLFxuICAgICAgICAgIGNvcnJlY3Q6IHRydWUsXG4gICAgICAgICAgY29tbWVudDogJ1VzZWQgY29ycmVjdGx5IGFuZCBhcHByb3ByaWF0ZWx5JyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHdvcmQ6ICdpbmNvcnJlY3RseScsXG4gICAgICAgICAgY29ycmVjdDogZmFsc2UsXG4gICAgICAgICAgY29tbWVudDogJ1VzZWQgaW5jb3JyZWN0bHkgaW4gdGhpcyBjb250ZXh0JyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSlcblxuICAgIHJlbmRlcig8QXBwIC8+KVxuICAgIFxuICAgIGNvbnN0IHRleHRhcmVhID0gc2NyZWVuLmdldEJ5UGxhY2Vob2xkZXJUZXh0KCdQYXN0ZSB5b3VyIGVzc2F5IGhlcmUuLi4nKVxuICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL2FuYWx5emUgZXNzYXkvaSB9KVxuICAgIFxuICAgIGF3YWl0IHVzZXIudHlwZSh0ZXh0YXJlYSwgJ1Rlc3QgZXNzYXknKVxuICAgIGF3YWl0IHVzZXIuY2xpY2soc3VibWl0QnV0dG9uKVxuICAgIFxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoJ1dvcmQtTGV2ZWwgRmVlZGJhY2snKSkudG9CZUluVGhlRG9jdW1lbnQoKVxuICAgIH0pXG4gICAgXG4gICAgLy8gQ2hlY2sgZm9yIGZlZWRiYWNrIGNvbnRlbnRcbiAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnYXJ0aWN1bGF0ZWQnKSkudG9CZUluVGhlRG9jdW1lbnQoKVxuICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KCdpbmNvcnJlY3RseScpKS50b0JlSW5UaGVEb2N1bWVudCgpXG4gICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoL3VzZWQgY29ycmVjdGx5L2kpKS50b0JlSW5UaGVEb2N1bWVudCgpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCBzaG93IGVycm9yIG1lc3NhZ2Ugb24gdXBsb2FkIGZhaWx1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpXG4gICAgdmkuc3B5T24oYXBpLCAndXBsb2FkRXNzYXknKS5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ05ldHdvcmsgZXJyb3InKSlcblxuICAgIHJlbmRlcig8QXBwIC8+KVxuICAgIFxuICAgIGNvbnN0IHRleHRhcmVhID0gc2NyZWVuLmdldEJ5UGxhY2Vob2xkZXJUZXh0KCdQYXN0ZSB5b3VyIGVzc2F5IGhlcmUuLi4nKVxuICAgIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL2FuYWx5emUgZXNzYXkvaSB9KVxuICAgIFxuICAgIGF3YWl0IHVzZXIudHlwZSh0ZXh0YXJlYSwgJ1Rlc3QgZXNzYXknKVxuICAgIGF3YWl0IHVzZXIuY2xpY2soc3VibWl0QnV0dG9uKVxuICAgIFxuICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRleHQoL25ldHdvcmsgZXJyb3IvaSkpLnRvQmVJblRoZURvY3VtZW50KClcbiAgICB9KVxuICB9KVxuXG4gIGl0KCdzaG91bGQgcmVzZXQgZm9ybSB3aGVuIGNsaWNraW5nIFwiQW5hbHl6ZSBBbm90aGVyIEVzc2F5XCInLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpXG4gICAgdmkuc3B5T24oYXBpLCAndXBsb2FkRXNzYXknKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBlc3NheV9pZDogJ3Rlc3QtMTIzJyxcbiAgICAgIHN0YXR1czogJ3Byb2Nlc3NlZCcsIC8vIFN0YXJ0IHdpdGggcHJvY2Vzc2VkIHRvIHNraXAgcG9sbGluZ1xuICAgICAgbWV0cmljczoge1xuICAgICAgICB3b3JkX2NvdW50OiA1MCxcbiAgICAgICAgdW5pcXVlX3dvcmRzOiA0MCxcbiAgICAgICAgdHlwZV90b2tlbl9yYXRpbzogMC44LFxuICAgICAgfSxcbiAgICAgIGZlZWRiYWNrOiBbXSxcbiAgICB9KVxuXG4gICAgcmVuZGVyKDxBcHAgLz4pXG4gICAgXG4gICAgY29uc3QgdGV4dGFyZWEgPSBzY3JlZW4uZ2V0QnlQbGFjZWhvbGRlclRleHQoJ1Bhc3RlIHlvdXIgZXNzYXkgaGVyZS4uLicpXG4gICAgY29uc3Qgc3VibWl0QnV0dG9uID0gc2NyZWVuLmdldEJ5Um9sZSgnYnV0dG9uJywgeyBuYW1lOiAvYW5hbHl6ZSBlc3NheS9pIH0pXG4gICAgXG4gICAgYXdhaXQgdXNlci50eXBlKHRleHRhcmVhLCAnVGVzdCBlc3NheScpXG4gICAgYXdhaXQgdXNlci5jbGljayhzdWJtaXRCdXR0b24pXG4gICAgXG4gICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgnTWV0cmljcycpKS50b0JlSW5UaGVEb2N1bWVudCgpXG4gICAgfSlcbiAgICBcbiAgICBjb25zdCByZXNldEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVJvbGUoJ2J1dHRvbicsIHsgbmFtZTogL2FuYWx5emUgYW5vdGhlciBlc3NheS9pIH0pXG4gICAgYXdhaXQgdXNlci5jbGljayhyZXNldEJ1dHRvbilcbiAgICBcbiAgICAvLyBTaG91bGQgc2hvdyBmb3JtIGFnYWluXG4gICAgZXhwZWN0KHNjcmVlbi5nZXRCeVBsYWNlaG9sZGVyVGV4dCgnUGFzdGUgeW91ciBlc3NheSBoZXJlLi4uJykpLnRvQmVJblRoZURvY3VtZW50KClcbiAgICBleHBlY3Qoc2NyZWVuLnF1ZXJ5QnlUZXh0KCdNZXRyaWNzJykpLm5vdC50b0JlSW5UaGVEb2N1bWVudCgpXG4gIH0pXG59KVxuXG4iXX0=